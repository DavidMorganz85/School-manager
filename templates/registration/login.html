{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="min-h-screen flex items-center justify-center p-6 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-700">
  <div class="w-full max-w-4xl bg-white/5 backdrop-blur-md border border-white/8 rounded-2xl shadow-2xl grid grid-cols-1 lg:grid-cols-2">
    <!-- Illustration column -->
    <div class="hidden lg:flex flex-col items-center justify-center p-8 bg-gradient-to-br from-primary-600 to-indigo-700 rounded-l-2xl">
      <img src="{% static 'images/login-illustration.svg' %}" alt="Illustration" class="w-3/4 mb-6" />
      <img src="{% static 'images/login-decor.svg' %}" alt="Decor" class="w-2/3 opacity-90" />
      <h2 class="mt-6 text-white text-2xl font-heading">Welcome back</h2>
      <p class="text-white/90 mt-2 text-center max-w-xs">Manage classes, students, finance and more â€” all in one place.</p>
    </div>

    <!-- Form column -->
    <div class="p-8">
      <div class="flex flex-col items-center mb-4">
        {% if school.logo %}
          <img src="{{ school.logo.url }}" alt="{{ school.name|default:'ATLAS' }}" class="w-16 h-16 rounded-full mb-3" />
        {% else %}
          <img src="{% static 'images/atlas_logo.png' %}" alt="ATLAS" class="w-16 h-16 rounded-full mb-3" />
        {% endif %}
        <h1 class="text-3xl font-heading text-white">ATLAS</h1>
        <p class="text-sm text-slate-300">Sign in to continue to your dashboard</p>
      </div>

    <form method="post" novalidate class="space-y-4">
      {% csrf_token %}
      {% if form.non_field_errors %}
        <div class="bg-red-600/20 text-red-200 px-3 py-2 rounded">{{ form.non_field_errors }}</div>
      {% endif %}

      <label class="block text-sm">
        <span class="text-slate-200">Username or email</span>
        <input
          type="text"
          name="{{ form.username.name }}"
          id="{{ form.username.id_for_label }}"
          value="{{ form.username.value|default_if_none:'' }}"
          class="mt-1 block w-full rounded-md bg-white/5 border border-white/10 text-white placeholder-slate-400 focus:ring-2 focus:ring-sky-500 px-3 py-2"
          autocomplete="username"
        />
        {% if form.username.errors %}
          <p class="text-red-300 text-sm mt-1">{{ form.username.errors.0 }}</p>
        {% endif %}
      </label>

      <label class="block text-sm relative" id="password-field">
        <span class="text-slate-200">Password</span>
        <input
          type="password"
          name="{{ form.password.name }}"
          id="{{ form.password.id_for_label }}"
          class="mt-1 block w-full rounded-md bg-white/5 border border-white/10 text-white placeholder-slate-400 pr-10 focus:ring-2 focus:ring-sky-500 px-3 py-2"
          autocomplete="current-password"
        />
        <button type="button" id="togglePassword" class="absolute right-2 top-9 text-slate-300 hover:text-white" aria-label="Toggle password visibility">
          <i class="fa fa-eye"></i>
        </button>
        {% if form.password.errors %}
          <p class="text-red-300 text-sm mt-1">{{ form.password.errors.0 }}</p>
        {% endif %}
      </label>

      <div class="flex items-center justify-between text-sm">
        <label class="inline-flex items-center gap-2 text-slate-300">
          <input type="checkbox" name="remember" class="rounded border-white/10 bg-white/3" />
          Remember me
        </label>
        <a href="{% url 'password_reset' %}" class="text-sky-400 hover:underline">Forgot password?</a>
      </div>

  <button type="submit" class="w-full py-2 rounded-md bg-gradient-to-r from-sky-500 to-indigo-500 text-white font-semibold shadow">Sign in</button>

      {% if form.errors %}
        <div class="bg-red-600/20 text-red-200 px-3 py-2 rounded">{{ form.errors }}</div>
      {% endif %}
    </form>

      <div class="mt-4 text-sm text-slate-400">
        <p>If you don't have an admin account, create one from the terminal with <code class="bg-white/5 px-1 rounded font-mono">python manage.py createsuperuser</code>.</p>
        <p class="mt-2">Admin site: <a href="{% url 'admin:index' %}" class="text-sky-400 hover:underline">/admin/</a></p>
      </div>
    </div>
  </div>
</div>

<script>
// Toggle password visibility
document.addEventListener('DOMContentLoaded', function () {
  const toggle = document.getElementById('togglePassword');
  const pwd = document.querySelector('#id_password');
  if (!toggle || !pwd) return;
  toggle.addEventListener('click', function () {
    const type = pwd.getAttribute('type') === 'password' ? 'text' : 'password';
    pwd.setAttribute('type', type);
    this.querySelector('i').classList.toggle('fa-eye-slash');
  });
});
</script>

{% endblock %}
