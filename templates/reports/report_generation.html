{% extends 'base.html' %}
{% load static %}

{% block title %}Report Generation - School Manager{% endblock %}

{% block content %}
<!-- Header -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
  <div class="px-6 py-4 border-b border-gray-200">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Report Generation</h1>
        <p class="text-gray-600">Generate comprehensive reports and analytics for school management</p>
      </div>
      <div class="mt-4 sm:mt-0 flex space-x-3">
        <button onclick="exportAllReports()" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
          <i class="fas fa-download mr-2"></i>
          Export All
        </button>
        <button onclick="scheduleReport()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
          <i class="fas fa-clock mr-2"></i>
          Schedule Report
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Report Categories -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
  <!-- Academic Reports -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200">
    <div class="p-6">
      <div class="flex items-center mb-4">
        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-graduation-cap text-blue-600 text-xl"></i>
        </div>
        <div class="ml-4">
          <h3 class="text-lg font-semibold text-gray-900">Academic Reports</h3>
          <p class="text-sm text-gray-600">Student performance and academic analytics</p>
        </div>
      </div>
      
      <div class="space-y-3">
        <button onclick="generateReport('academic_performance')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-900">Academic Performance Report</span>
            <i class="fas fa-chevron-right text-gray-400"></i>
          </div>
          <p class="text-xs text-gray-500 mt-1">Student grades, attendance, and progress analysis</p>
        </button>
        
        <button onclick="generateReport('exam_results')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-900">Exam Results Report</span>
            <i class="fas fa-chevron-right text-gray-400"></i>
          </div>
          <p class="text-xs text-gray-500 mt-1">Detailed exam performance and statistics</p>
        </button>
        
        <button onclick="generateReport('class_performance')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-900">Class Performance Report</span>
            <i class="fas fa-chevron-right text-gray-400"></i>
          </div>
          <p class="text-xs text-gray-500 mt-1">Performance comparison across classes</p>
        </button>
      </div>
    </div>
  </div>

  <!-- Financial Reports -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200">
    <div class="p-6">
      <div class="flex items-center mb-4">
        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
        </div>
        <div class="ml-4">
          <h3 class="text-lg font-semibold text-gray-900">Financial Reports</h3>
          <p class="text-sm text-gray-600">Fee collection and financial analytics</p>
        </div>
      </div>
      
      <div class="space-y-3">
        <button onclick="generateReport('fee_collection')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-900">Fee Collection Report</span>
            <i class="fas fa-chevron-right text-gray-400"></i>
          </div>
          <p class="text-xs text-gray-500 mt-1">Fee collection status and outstanding amounts</p>
        </button>
        
        <button onclick="generateReport('financial_summary')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-900">Financial Summary</span>
            <i class="fas fa-chevron-right text-gray-400"></i>
          </div>
          <p class="text-xs text-gray-500 mt-1">Overall financial health and trends</p>
        </button>
        
        <button onclick="generateReport('payment_history')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-900">Payment History</span>
            <i class="fas fa-chevron-right text-gray-400"></i>
          </div>
          <p class="text-xs text-gray-500 mt-1">Detailed payment records and trends</p>
        </button>
      </div>
    </div>
  </div>

  <!-- Administrative Reports -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200">
    <div class="p-6">
      <div class="flex items-center mb-4">
        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-chart-bar text-purple-600 text-xl"></i>
        </div>
        <div class="ml-4">
          <h3 class="text-lg font-semibold text-gray-900">Administrative Reports</h3>
          <p class="text-sm text-gray-600">School operations and management analytics</p>
        </div>
      </div>
      
      <div class="space-y-3">
        <button onclick="generateReport('attendance_summary')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-900">Attendance Summary</span>
            <i class="fas fa-chevron-right text-gray-400"></i>
          </div>
          <p class="text-xs text-gray-500 mt-1">Student and staff attendance analytics</p>
        </button>
        
        <button onclick="generateReport('enrollment_report')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-900">Enrollment Report</span>
            <i class="fas fa-chevron-right text-gray-400"></i>
          </div>
          <p class="text-xs text-gray-500 mt-1">Student enrollment trends and statistics</p>
        </button>
        
        <button onclick="generateReport('staff_performance')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors duration-200">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-900">Staff Performance</span>
            <i class="fas fa-chevron-right text-gray-400"></i>
          </div>
          <p class="text-xs text-gray-500 mt-1">Teacher and staff performance analytics</p>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Recent Reports -->
<div class="bg-white shadow-sm border border-gray-200 rounded-lg mb-8">
  <div class="px-6 py-4 border-b border-gray-200">
    <h3 class="text-lg font-medium text-gray-900">Recent Reports</h3>
  </div>
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Report Name</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Generated</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="flex-shrink-0 h-10 w-10">
                <div class="h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center">
                  <i class="fas fa-file-pdf text-blue-600"></i>
                </div>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-900">Academic Performance Report</div>
                <div class="text-sm text-gray-500">Q1 2024</div>
              </div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Academic</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">2 hours ago</td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
              <i class="fas fa-check-circle mr-1"></i>Completed
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <div class="flex space-x-2">
              <button onclick="downloadReport(1)" class="text-blue-600 hover:text-blue-900">
                <i class="fas fa-download"></i>
              </button>
              <button onclick="viewReport(1)" class="text-gray-600 hover:text-gray-900">
                <i class="fas fa-eye"></i>
              </button>
              <button onclick="shareReport(1)" class="text-green-600 hover:text-green-900">
                <i class="fas fa-share"></i>
              </button>
            </div>
          </td>
        </tr>
        
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="flex-shrink-0 h-10 w-10">
                <div class="h-10 w-10 rounded-lg bg-yellow-100 flex items-center justify-center">
                  <i class="fas fa-file-excel text-yellow-600"></i>
                </div>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-900">Fee Collection Report</div>
                <div class="text-sm text-gray-500">March 2024</div>
              </div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Financial</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">1 day ago</td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
              <i class="fas fa-check-circle mr-1"></i>Completed
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <div class="flex space-x-2">
              <button onclick="downloadReport(2)" class="text-blue-600 hover:text-blue-900">
                <i class="fas fa-download"></i>
              </button>
              <button onclick="viewReport(2)" class="text-gray-600 hover:text-gray-900">
                <i class="fas fa-eye"></i>
              </button>
              <button onclick="shareReport(2)" class="text-green-600 hover:text-green-900">
                <i class="fas fa-share"></i>
              </button>
            </div>
          </td>
        </tr>
        
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="flex-shrink-0 h-10 w-10">
                <div class="h-10 w-10 rounded-lg bg-red-100 flex items-center justify-center">
                  <i class="fas fa-spinner text-red-600"></i>
                </div>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-900">Attendance Summary</div>
                <div class="text-sm text-gray-500">April 2024</div>
              </div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Administrative</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">In progress</td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
              <i class="fas fa-clock mr-1"></i>Processing
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button onclick="cancelReport(3)" class="text-red-600 hover:text-red-900">
              <i class="fas fa-times"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Report Generation Modal -->
<div id="reportModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
  <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
    <div class="mt-3">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-medium text-gray-900" id="reportModalTitle">Generate Report</h3>
        <button onclick="closeReportModal()" class="text-gray-400 hover:text-gray-600">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="reportForm" class="space-y-4">
        <input type="hidden" id="reportType" name="report_type">
        
        <div>
          <label class="block text-sm font-medium text-gray-700">Report Period</label>
          <div class="grid grid-cols-2 gap-2 mt-1">
            <input type="date" id="startDate" class="border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500" required>
            <input type="date" id="endDate" class="border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500" required>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700">Filter Options</label>
          <div class="mt-2 space-y-2">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-gray-700">Class</label>
                <select id="classFilter" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500">
                  <option value="">All Classes</option>
                  <option value="grade_9">Grade 9</option>
                  <option value="grade_10">Grade 10</option>
                  <option value="grade_11">Grade 11</option>
                  <option value="grade_12">Grade 12</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-700">Subject</label>
                <select id="subjectFilter" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500">
                  <option value="">All Subjects</option>
                  <option value="mathematics">Mathematics</option>
                  <option value="english">English</option>
                  <option value="science">Science</option>
                  <option value="history">History</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700">Output Format</label>
          <div class="mt-2 space-y-2">
            <label class="inline-flex items-center">
              <input type="radio" name="format" value="pdf" class="form-radio" checked>
              <span class="ml-2 text-sm text-gray-700">PDF</span>
            </label>
            <label class="inline-flex items-center">
              <input type="radio" name="format" value="excel" class="form-radio">
              <span class="ml-2 text-sm text-gray-700">Excel</span>
            </label>
            <label class="inline-flex items-center">
              <input type="radio" name="format" value="csv" class="form-radio">
              <span class="ml-2 text-sm text-gray-700">CSV</span>
            </label>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700">Email Options</label>
          <div class="mt-2 space-y-2">
            <label class="inline-flex items-center">
              <input type="checkbox" class="form-checkbox" id="emailReport">
              <span class="ml-2 text-sm text-gray-700">Email report when ready</span>
            </label>
            <div id="emailOptions" class="hidden ml-6">
              <input type="email" id="emailAddress" placeholder="Enter email address" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500">
            </div>
          </div>
        </div>
        
        <div class="flex justify-end space-x-3 pt-4">
          <button type="button" onclick="closeReportModal()" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            Cancel
          </button>
          <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700">
            Generate Report
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Schedule Report Modal -->
<div id="scheduleModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-medium text-gray-900">Schedule Report</h3>
        <button onclick="closeScheduleModal()" class="text-gray-400 hover:text-gray-600">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="scheduleForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Report Type</label>
          <select id="scheduledReportType" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500" required>
            <option value="">Select Report Type</option>
            <option value="academic_performance">Academic Performance</option>
            <option value="fee_collection">Fee Collection</option>
            <option value="attendance_summary">Attendance Summary</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700">Frequency</label>
          <select id="reportFrequency" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500" required>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="quarterly">Quarterly</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700">Email Recipients</label>
          <input type="email" id="scheduleEmail" placeholder="Enter email addresses (comma separated)" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500" required>
        </div>
        
        <div class="flex justify-end space-x-3 pt-4">
          <button type="button" onclick="closeScheduleModal()" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            Cancel
          </button>
          <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700">
            Schedule Report
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- JavaScript -->
<script>
function generateReport(reportType) {
  document.getElementById('reportType').value = reportType;
  document.getElementById('reportModalTitle').textContent = 'Generate ' + reportType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()) + ' Report';
  document.getElementById('reportModal').classList.remove('hidden');
}

function closeReportModal() {
  document.getElementById('reportModal').classList.add('hidden');
  document.getElementById('reportForm').reset();
}

function scheduleReport() {
  document.getElementById('scheduleModal').classList.remove('hidden');
}

function closeScheduleModal() {
  document.getElementById('scheduleModal').classList.add('hidden');
  document.getElementById('scheduleForm').reset();
}

function downloadReport(reportId) {
  // In a real implementation, this would download the report
  alert('Downloading report ' + reportId);
}

function viewReport(reportId) {
  // In a real implementation, this would open the report in a new tab
  alert('Viewing report ' + reportId);
}

function shareReport(reportId) {
  // In a real implementation, this would open a share dialog
  alert('Sharing report ' + reportId);
}

function cancelReport(reportId) {
  if (confirm('Are you sure you want to cancel this report generation?')) {
    // In a real implementation, this would cancel the report
    alert('Report generation cancelled');
  }
}

function exportAllReports() {
  // In a real implementation, this would export all available reports
  alert('Exporting all reports...');
}

// Email options toggle
document.getElementById('emailReport').addEventListener('change', function() {
  const emailOptions = document.getElementById('emailOptions');
  if (this.checked) {
    emailOptions.classList.remove('hidden');
  } else {
    emailOptions.classList.add('hidden');
  }
});

// Form submissions
document.getElementById('reportForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  // In a real implementation, this would generate the report
  const formData = new FormData(this);
  console.log('Generating report:', Object.fromEntries(formData));
  
  closeReportModal();
  alert('Report generation started! You will be notified when it\'s ready.');
});

document.getElementById('scheduleForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  // In a real implementation, this would schedule the report
  const formData = new FormData(this);
  console.log('Scheduling report:', Object.fromEntries(formData));
  
  closeScheduleModal();
  alert('Report scheduled successfully!');
});

// Close modals when clicking outside
document.getElementById('reportModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeReportModal();
  }
});

document.getElementById('scheduleModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeScheduleModal();
  }
});

// Set default dates
const today = new Date();
const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);

document.getElementById('startDate').valueAsDate = firstDay;
document.getElementById('endDate').valueAsDate = lastDay;
</script>
{% endblock %}
